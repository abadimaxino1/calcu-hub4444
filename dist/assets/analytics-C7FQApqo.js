var c={};const w=["calcu_consent","calcu_consent_v1","consent"];function d(){try{for(const t of w){const e=localStorage.getItem(t);if(e)try{const a=JSON.parse(e);if(typeof a=="object")return a}catch{if(e==="analytics"||e==="all"||e==="true")return{analytics:!0,ads:!0}}}}catch{}return{analytics:!1,ads:!1}}function g(t,e={}){return new Promise((a,n)=>{if(document.querySelector(`script[src="${t}"]`))return a();const o=document.createElement("script");o.src=t,o.async=!0,Object.keys(e).forEach(i=>o.setAttribute(i,e[i])),o.onload=()=>a(),o.onerror=i=>n(i),document.head.appendChild(o)})}async function p(){if(typeof window>"u"||!window.document)return;const t=d(),e=c.VITE_GA_ID||c.GA_MEASUREMENT_ID||"",a=c.VITE_ADSENSE||c.ADSENSE_CLIENT_ID||"";if(t.analytics&&e)try{let n=function(){window.dataLayer.push(arguments)};window.dataLayer||(window.dataLayer=[]),window.gtag=window.gtag||n,await g(`https://www.googletagmanager.com/gtag/js?id=${e}`),window.gtag("js",new Date),window.gtag("config",e,{anonymize_ip:!0})}catch(n){console.warn("Failed to load GA",n&&n.message)}if(t.ads&&a)try{await g("https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js",{"data-ad-client":a});try{(window.adsbygoogle=window.adsbygoogle||[]).push({})}catch{}}catch(n){console.warn("Failed to load AdSense",n&&n.message)}}function y(){return!!d().analytics}function h(){return!!d().ads}function l(){if(typeof window>"u")return{utmSource:null,utmMedium:null,utmCampaign:null,utmTerm:null,utmContent:null};const t=new URLSearchParams(window.location.search);return{utmSource:t.get("utm_source"),utmMedium:t.get("utm_medium"),utmCampaign:t.get("utm_campaign"),utmTerm:t.get("utm_term"),utmContent:t.get("utm_content")}}function S(){const t=l();if(t.utmSource||t.utmMedium||t.utmCampaign)try{sessionStorage.setItem("calcu_utm",JSON.stringify(t))}catch{}}function m(){try{const t=sessionStorage.getItem("calcu_utm");if(t)return JSON.parse(t)}catch{}return l()}function s(){try{let t=sessionStorage.getItem("calcu_session");return t||(t="sess_"+Math.random().toString(36).substring(2)+Date.now().toString(36),sessionStorage.setItem("calcu_session",t)),t}catch{return"sess_"+Math.random().toString(36).substring(2)}}function r(){if(typeof window>"u")return"desktop";const t=navigator.userAgent.toLowerCase();return/tablet|ipad|playbook|silk/i.test(t)?"tablet":/mobile|iphone|ipod|android|blackberry|opera mini|iemobile/i.test(t)?"mobile":"desktop"}function u(){return typeof document>"u"?"ar":document.documentElement.lang||"ar"}const f="/api/analytics";async function _(t){const e=t||(typeof window<"u"?window.location.pathname:"/"),a=m();try{await fetch(`${f}/pageview`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:s(),pagePath:e,referrer:typeof document<"u"?document.referrer:null,device:r(),locale:u(),...a})})}catch(n){console.warn("Failed to track page view",n)}}async function b(t,e,a,n=0){const o=m();try{await fetch(`${f}/calculation`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:s(),calculatorType:t,inputSummary:e,resultSummary:a,durationMs:n,device:r(),locale:u(),...o})})}catch(i){console.warn("Failed to track calculation",i)}}async function E(t,e,a){const n=a||(typeof window<"u"?window.location.pathname:"/");try{await fetch("/api/ads/event",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({adSlotId:t,eventType:e,sessionId:s(),pagePath:n,device:r(),locale:u()})})}catch(o){console.warn("Failed to track ad event",o)}}typeof window<"u"&&S();const I={initAnalytics:p,hasAnalyticsConsent:y,hasAdsConsent:h,getUTMParams:l,getPersistedUTMParams:m,getSessionId:s,getDeviceType:r,getLocale:u,trackPageView:_,trackCalculation:b,trackAdEvent:E};export{I as default,r as getDeviceType,u as getLocale,m as getPersistedUTMParams,s as getSessionId,l as getUTMParams,h as hasAdsConsent,y as hasAnalyticsConsent,p as initAnalytics,S as persistUTMParams,E as trackAdEvent,b as trackCalculation,_ as trackPageView};
